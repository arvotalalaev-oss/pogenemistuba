<script>
  // Minimal safe runtime (no background images, no service worker)
  const pagesData = [
    { q: 'SISESTA ÕIGETE TEGIJATE SUMMA ...', answer: '22955' },
    { q: 'VAATA VIHJET: ...', answer: 'paeluss', hint: 'vaata kõikide laudade alla...' },
    { q: 'kuklaluu', answer: 'peremeesorganism', hint: 'koht kus parasiidil on hea soe pikutada', onCorrect: 'pöidlaluu ja käsigranaat' }
  ];

  const wrap = document.getElementById('wrap');
  function createPage(p,i){
    const el = document.createElement('div');
    el.className = 'page';
    el.dataset.index = i;
    el.style.display = 'block';
    el.innerHTML = `
      <div class="slot" aria-hidden="false">
        <div class="question">${p.q}</div>
        <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%">
          <div class="input-row">
            <input class="code" id="input-${i}" type="text" maxlength="40" placeholder="Kirjuta vastus siia" />
          </div>
          <div class="status" id="status-${i}"></div>
        </div>
      </div>
      <div class="footer">
        <button class="btn" data-prev data-index="${i}">Eelmine</button>
        <div style="width:12px"></div>
        <button class="btn" data-next data-index="${i}">Järgmine</button>
      </div>
    `;
    return el;
  }

  wrap.innerHTML = '';
  pagesData.forEach((p,i)=> wrap.appendChild(createPage(p,i)));
  let current = 0;
  function show(idx){
    Array.from(document.querySelectorAll('.page')).forEach((pe,i)=> pe.style.display = (i===idx)?'block':'none');
    const inp = document.getElementById('input-'+idx);
    if(inp) inp.focus();
    current = idx;
  }
  show(0);

  function sanitize(s){ return (s||'').toString().trim().toUpperCase().slice(0,40); }

  wrap.addEventListener('click', (e) => {
    const nextBtn = e.target.closest('[data-next]');
    if(nextBtn){
      const idx = Number(nextBtn.dataset.index);
      const inp = document.getElementById('input-'+idx);
      const status = document.getElementById('status-'+idx);
      const val = sanitize(inp ? inp.value : '');
      const expected = sanitize(pagesData[idx].answer);
      if(val === expected){
        status.textContent = 'Õige — edasi liigud.'; status.style.color = '#9fd';
        if(pagesData[idx].onCorrect){ status.textContent = 'Õige — ' + pagesData[idx].onCorrect; }
        setTimeout(()=> show(Math.min(pagesData.length-1, idx+1)), 400);
      } else {
        status.textContent = pagesData[idx].hint ? ('Vale kood — vihje: ' + pagesData[idx].hint) : 'Vale kood — proovi uuesti.';
        status.style.color = '#f99';
        if(inp) inp.animate([{transform:'translateX(-6px)'},{transform:'translateX(6px)'},{transform:'translateX(0)'}],{duration:300});
        if(inp) inp.focus();
      }
      return;
    }
    const prevBtn = e.target.closest('[data-prev]');
    if(prevBtn){ const idx = Number(prevBtn.dataset.index); show(Math.max(0, idx-1)); return; }
  });

  window.addEventListener('keydown', (e)=>{
    if(e.key === 'ArrowRight'){
      const inp = document.getElementById('input-'+current);
      const val = sanitize(inp ? inp.value : '');
      const expected = sanitize(pagesData[current].answer);
      if(val === expected){ show(Math.min(pagesData.length-1, current+1)); }
      else { const status = document.getElementById('status-'+current); status.textContent = 'Vale kood — proovi uuesti.'; status.style.color = '#f99'; if(inp) inp.animate([{transform:'translateX(-6px)'},{transform:'translateX(6px)'},{transform:'translateX(0)'}],{duration:300}); if(inp) inp.focus(); }
    }
    if(e.key === 'ArrowLeft') show(Math.max(0,current-1));
    if(e.key === 'Enter'){
      const inp = document.getElementById('input-'+current);
      if(document.activeElement === inp){
        const val = sanitize(inp ? inp.value : '');
        const expected = sanitize(pagesData[current].answer);
        const status = document.getElementById('status-'+current);
        if(val === expected){
          status.textContent = 'Õige — edasi liigud.'; status.style.color = '#9fd';
          if(pagesData[current].onCorrect){ status.textContent = 'Õige — ' + pagesData[current].onCorrect; }
          setTimeout(()=> show(Math.min(pagesData.length-1,current+1)), 300);
        } else {
          status.textContent = pagesData[current].hint ? ('Vale kood — vihje: ' + pagesData[current].hint) : 'Vale kood — proovi uuesti.';
          status.style.color = '#f99';
          if(inp) inp.animate([{transform:'translateX(-6px)'},{transform:'translateX(6px)'},{transform:'translateX(0)'}],{duration:300});
        }
      }
    }
  });
</script>
